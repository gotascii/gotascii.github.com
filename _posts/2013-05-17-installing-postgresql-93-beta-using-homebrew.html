---
layout: post
title: Installing Postgresql 9.3 Beta using Homebrew
excerpt: Recently, I've been working on a project that relies heavily on Postgresql and I've come to appreciate it's flexibility. New features like <a href="http://www.postgresql.org/docs/9.2/static/hstore.html">hstore</a>, <a href="http://wiki.postgresql.org/wiki/What's_new_in_PostgreSQL_9.2#JSON_datatype">json</a> and <a href="https://code.google.com/p/plv8js/">plv8js</a> allow for rapid application development. <a href="https://wiki.postgresql.org/wiki/Index-only_scans">Index-only scans</a> and <a href="http://wiki.postgresql.org/wiki/Streaming_Replication">native streaming replication</a> make Postgresql even more appealing in a traditional context. After reading about the <a href="http://www.postgresql.org/about/news/1463/">forthcoming features of 9.3</a>, I went in search of a way to install 9.3 beta 1 along side my existing 9.2 installation.
---
<p>The magic begins with <a href="https://github.com/petere/homebrew-postgresql">petere's homebrew-postgresql formulae</a>. The first step is to follow the README and brew tap the repository.</p>

{% highlight sh %}
brew tap petere/postgresql
{% endhighlight %}

<p>Next, install postgresql-9.3.</p>

{% highlight sh %}
brew install postgresql-9.3
{% endhighlight %}

<p>This will install postgresql into <code>/usr/local/opt/postgres-9.3</code>. It will not symlink any of the executables in <code>/usr/local/opt/postgres-9.3/bin</code> to <code>/usr/local/bin</code> because the formula was added via brew tap. This means that should you have an existing brew-based postgres install the executables won't be overwritten by 9.3. It also means that there's a little more legwork involved in getting everything setup. Currently, I'm just calling the executables directly via their full path, but you could add <code>/usr/local/opt/postgresql-9.3/bin</code> to your PATH and avoid lots of typing.</p>

<p>At this point, we need to initialize the database.</p>

{% highlight sh %}
/usr/local/opt/postgresql-9.3/bin/initdb /usr/local/var/postgres-9.3 -E utf8
{% endhighlight %}

<p>Once that finishes you can start postgres manually using the following command.</p>

{% highlight sh %}
/usr/local/opt/postgresql-9.3/bin/pg_ctl -D /usr/local/var/postgres-9.3 -l /usr/local/var/postgres-9.3/server.log start
{% endhighlight %}

<p>If you want postgres to automatically start on boot, use the following plist to create a LaunchAgent.</p>

{% highlight xml %}
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>KeepAlive</key>
  <true/>
  <key>Label</key>
  <string>homebrew.mxcl.postgresql</string>
  <key>ProgramArguments</key>
  <array>
    <string>/usr/local/opt/postgresql-9.3/bin/postgres</string>
    <string>-D</string>
    <string>/usr/local/var/postgres-9.3</string>
    <string>-r</string>
    <string>/usr/local/var/postgres-9.3/server.log</string>
  </array>
  <key>RunAtLoad</key>
  <true/>
  <key>WorkingDirectory</key>
  <string>/usr/local</string>
  <key>StandardErrorPath</key>
  <string>/usr/local/var/postgres-9.3/server.log</string>
</dict>
</plist>
{% endhighlight %}

<p>Save this plist into <code>/usr/local/opt/postgresql-9.3/homebrew.mxcl.postgresql.plist</code>. Then symlink this file into <code>~/Library/LaunchAgents</code> using the following command.</p>

{% highlight sh %}
ln -sfv /usr/local/opt/postgresql-9.3/*.plist ~/Library/LaunchAgents
{% endhighlight %}

<p>Lastly, start up postgres immediately using launchctl.</p>

{% highlight sh %}
launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
{% endhighlight %}

<p>Check out the <a href="http://www.postgresql.org/about/news/1463/">9.3 beta 1 release notes</a> or <a href="http://michael.otacoo.com/postgresql-2/postgres-9-3-feature-highlight-json-data-generation/">Postgres 9.3 feature highlight: JSON data generation</a> for more information on some interesting new features.</p>
